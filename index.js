/* global wordbank variable */
var wordBank = [{
  'english': 'Welcome',
  'welsh': 'Croeso'
},
{
  'english': 'Beer',
  'welsh': 'Cwrw'
},
{
  'english': 'Leeks',
  'welsh': 'Cennin'
},
{
  'english': 'Peas',
  'welsh': 'Pys'
},
{
  'english': 'TV',
  'welsh': 'Teledu'
},
{
  'english': 'Desk',
  'welsh': 'Desg'
},
{
  'english': 'Either',
  'welsh': 'Chwaith'
},
{
  'english': 'Want',
  'welsh': 'Eisiau'
},
{
  'english': 'Enjoy',
  'welsh': 'Mwynhau'
},
{
  'english': 'Good',
  'welsh': 'Da'
},
{
  'english': 'Morning',
  'welsh': 'Bore'
},
{
  'english': 'Afternoon',
  'welsh': 'Prynhawn'
},
{
  'english': 'Night',
  'welsh': 'Nos'
},
{
  'english': 'Today',
  'welsh': 'Heddiw'
},
{
  'english': 'Tomorrow',
  'welsh': 'Yfory'
},
{
  'english': 'Yesterday',
  'welsh': 'Ddoe'
},
{
  'english': 'Tonight',
  'welsh': 'Heno'
},
{
  'english': 'Week',
  'welsh': 'Wythnos'
},
{
  'english': 'Weekend',
  'welsh': 'Penwythnos'
},
{
  'english': 'Now',
  'welsh': 'Nawr'
},
{
  'english': 'Going',
  'welsh': 'Mynd'
},
{
  'english': 'Welsh',
  'welsh': 'Cymraeg'
},
{
  'english': 'English',
  'welsh': 'Saesneg'
},
{
  'english': 'Thanks',
  'welsh': 'Diolch'
},
{
  'english': 'But',
  'welsh': 'Ond'
},
{
  'english': 'Name',
  'welsh': 'Enw'
},
{
  'english': 'Carrot',
  'welsh': 'Moron'
},
{
  'english': 'Bread',
  'welsh': 'Bara'
},
{
  'english': 'Apple',
  'welsh': 'Afal'
},
{
  'english': 'Sausage',
  'welsh': 'Selsig'
},
{
  'english': 'Meat',
  'welsh': 'Cig'
},
{
  'english': 'Goodbye',
  'welsh': 'Hwyl Fawr'
},
{
  'english': 'Tea',
  'welsh': 'Te'
},
{
  'english': 'Wine',
  'welsh': 'Gwin'
},
{
  'english': 'Water',
  'welsh': 'Dwr'
},
{
  'english': 'Coffee',
  'welsh': 'Coffi'
},
{
  'english': 'Saucepan',
  'welsh': 'Sosban'
},
{
  'english': 'Drink',
  'welsh': 'Yfed'
},
{
  'english': 'Eat',
  'welsh': 'Bwyta'
},
{
  'english': 'Dog',
  'welsh': 'Ci'
},
{
  'english': 'Cat',
  'welsh': 'Cath'
},
{
  'english': 'Sheep',
  'welsh': 'Dafad'
},
{
  'english': 'Mouse',
  'welsh': 'Llygoden'
},
{
  'english': 'Cow',
  'welsh': 'Buwch'
},
{
  'english': 'Whale',
  'welsh': 'Morfil'
},
{
  'english': 'Crab',
  'welsh': 'Cranc'
},
{
  'english': 'Turtle',
  'welsh': 'Crwban'
},
{
  'english': 'Pig',
  'welsh': 'Mochyn'
},
{
  'english': 'Egg',
  'welsh': 'Wy'
},
{
  'english': 'Phone',
  'welsh': 'Ffôn'
},
{
  'english': 'Surprise',
  'welsh': 'Syndod'
},
{
  'english': 'Suit',
  'welsh': 'Siwt'
},
{
  'english': 'Microwave',
  'welsh': 'Meicrodon'
},
{
  'english': 'Wear',
  'welsh': 'Gwisgo'
},
{
  'english': 'Clothes',
  'welsh': 'Dillad'
},
{
  'english': 'Gloves',
  'welsh': 'Menig'
},
{
  'english': 'Jacket',
  'welsh': 'Siaced'
},
{
  'english': 'Trousers',
  'welsh': 'Trowsus'
},
{
  'english': 'Shoes',
  'welsh': 'Esgidiau'
},
{
  'english': 'Skirt',
  'welsh': 'Sgert'
},
{
  'english': 'Very',
  'welsh': 'Iawn'
},
{
  'english': 'Awful',
  'welsh': 'Ofnadwy'
},
{
  'english': 'Swimming',
  'welsh': 'Nofio'
},
{
  'english': 'Rugby',
  'welsh': 'Rygbi'
},
{
  'english': 'Learn',
  'welsh': 'Dysgu'
},
{
  'english': 'Sleep',
  'welsh': 'Cysgu'
},
{
  'english': 'Dancing',
  'welsh': 'Dawnsio'
},
{
  'english': 'Speak',
  'welsh': 'Siarad'
},
{
  'english': 'Yes',
  'welsh': 'Ydw'
},
{
  'english': 'No',
  'welsh': 'Nac ydw'
},
{
  'english': 'New',
  'welsh': 'Newydd'
},
{
  'english': 'Again',
  'welsh': 'Eto'
},
{
  'english': 'Breakfast',
  'welsh': 'Brecwast'
},
{
  'english': 'Day',
  'welsh': 'Dydd'
},
{
  'english': 'Shirt',
  'welsh': 'Crys'
},
{
  'english': 'Dress',
  'welsh': 'Ffrog'
},
{
  'english': 'Hat',
  'welsh': 'Het'
},
{
  'english': 'Tie',
  'welsh': 'Tei'
},
{
  'english': 'Wait',
  'welsh': 'Aros'
},
{
  'english': 'Bike',
  'welsh': 'Beic'
},
{
  'english': 'Milk',
  'welsh': 'Llaeth'
},
{
  'english': 'Enjoy',
  'welsh': 'Mwynhau'
},
{
  'english': 'Like',
  'welsh': 'Hoffi'
},
{
  'english': 'One',
  'welsh': 'Un'
},
{
  'english': 'Two',
  'welsh': 'Dau'
},
{
  'english': 'Three',
  'welsh': 'Tri'
},
{
  'english': 'Four',
  'welsh': 'Pedwar'
},
{
  'english': 'Five',
  'welsh': 'Pump'
},
{
  'english': 'Six',
  'welsh': 'Chwech'
},
{
  'english': 'Seven',
  'welsh': 'Saith'
},
{
  'english': 'Eight',
  'welsh': 'Wyth'
},
{
  'english': 'Nine',
  'welsh': 'Naw'
},
{
  'english': 'Ten',
  'welsh': 'Deg'
},
{
  'english': 'Here',
  'welsh': 'Yma'
},
{
  'english': 'There',
  'welsh': 'Yno'
},
{
  'english': 'Near',
  'welsh': 'Ger'
},
{
  'english': 'Visit',
  'welsh': 'Ymweld'
},
{
  'english': 'Play',
  'welsh': 'Chwarae'
},
{
  'english': 'Squash',
  'welsh': 'Sboncen'
},
{
  'english': 'Black',
  'welsh': 'Du'
},
{
  'english': 'Pink',
  'welsh': 'Pinc'
},
{
  'english': 'Blue',
  'welsh': 'Glas'
},
{
  'english': 'Red',
  'welsh': 'Coch'
},
{
  'english': 'Green',
  'welsh': 'Gwyrdd'
},
{
  'english': 'Deer',
  'welsh': 'Carw'
},
{
  'english': 'Library',
  'welsh': 'Llyfrgell'
},
{
  'english': 'Pub',
  'welsh': 'Tafarn'
},
{
  'english': 'Hospital',
  'welsh': 'Ysbyty'
},
{
  'english': 'School',
  'welsh': 'Ysgol'
},
{
  'english': 'House',
  'welsh': 'Tŷ'
},
{
  'english': 'Beach',
  'welsh': 'Traeth'
},
{
  'english': 'Doctor',
  'welsh': 'Meddyg'
},
{
  'english': 'Teacher',
  'welsh': 'Athro'
},
{
  'english': 'Police',
  'welsh': 'Heddlu'
},
{
  'english': 'Nurse',
  'welsh': 'Nyrs'
},
{
  'english': 'Farmer',
  'welsh': 'Ffermwr'
},
{
  'english': 'Falling',
  'welsh': 'Cwympo'
},
{
  'english': 'Month',
  'welsh': 'Mis'
},
{
  'english': 'January',
  'welsh': 'Ionawr'
},
{
  'english': 'February',
  'welsh': 'Chwefror'
},
{
  'english': 'March',
  'welsh': 'Mawrth'
},
{
  'english': 'April',
  'welsh': 'Ebrill'
},
{
  'english': 'May',
  'welsh': 'Mai'
},
{
  'english': 'June',
  'welsh': 'Mehefin'
},
{
  'english': 'July',
  'welsh': 'Gorffennaf'
},
{
  'english': 'August',
  'welsh': 'Awst'
},
{
  'english': 'September',
  'welsh': 'Medi'
},
{
  'english': 'October',
  'welsh': 'Hydref'
},
{
  'english': 'November',
  'welsh': 'Tachwedd'
},
{
  'english': 'December',
  'welsh': 'Rhagfyr'
},
{
  'english': 'Married',
  'welsh': 'Priodi'
},
{
  'english': 'Dad',
  'welsh': 'Tad'
},
{
  'english': 'Mum',
  'welsh': 'Mam'
},
{
  'english': 'Sister',
  'welsh': 'Chwaer'
},
{
  'english': 'Brother',
  'welsh': 'Brawd'
},
{
  'english': 'Know',
  'welsh': 'Nabod'
},
];



/* global welsh and english variables */
var score = 0;

var clickedCards = [];
var dataCompare = [];

var welsh = [];
var english = [];

function cardClicked(_event) {
this.firstChild.classList.remove('hidden');
this.classList.add('done');
dataCompare.push(this.getAttribute('data-index'));
clickedCards.push(this);
endGame();

if (dataCompare.length >= 2) {
  stopClickCards();
  if (dataCompare[0] !== dataCompare[1]) {
      setTimeout(function() {
          for (let card of clickedCards) {
              card.classList.remove('done');
              card.firstElementChild.classList.add('hidden');
              clickCards();
          }
          dataCompare = [];
          clickedCards = [];
      }, 250);
  } else {
      score += 10;
      document.getElementById("score").innerHTML = `Score: ${score}`;
      clickCards();

      for (let card of clickedCards) {
          card.style.backgroundColor = "var(--dk-green)";
      }
      dataCompare = [];
      clickedCards = [];
  }
}
}

/* Show text when 'how to play' is clicked */
function clickHowTo() {
var x = document.getElementById("how-to-text");
if (x.style.display === "none") {
  x.style.display = "block";
} else {
  x.style.display = "none";
}
}

/*Close how to text when click anywhere else on the page (code tutorial from https://www.blustemy.io/detecting-a-click-outside-an-element-in-javascript/)*/ 
document.addEventListener("click", (evt) => {
  const howToButton = document.getElementById("how-to");
  let targetElement = evt.target;

    if (targetElement == howToButton) {
      clickHowTo();
      return;
    } else {
      document.getElementById("how-to-text").style.display = "none";
    }
  }
);


/* Start game - reveal cards, remove play button*/
function changeCards() {
resetGame();
startTimer();
const cardContainer = [];

/* Generate random set of six word pairs*/
let oldElement;
for (let i = wordBank.length - 1; i > 0; i--) {
  let rand = Math.floor(Math.random() * (i + 1));
  oldElement = wordBank[i];
  wordBank[i] = wordBank[rand];
  wordBank[rand] = oldElement;
}
var wordBankShuffle = wordBank.slice(0, 6);
/* create cardContainer for welsh/english words*/
for (i = 0; i < wordBankShuffle.length; i++) {
  var engCard = document.createElement('div');
  engCard.dataset.index = i;
  engCard.setAttribute('class', 'card');
  engCard.innerHTML = wordBankShuffle[i].english;
  english.push(wordBankShuffle[i].english);
  org_text = engCard.innerHTML;
  new_html = "<p class='hidden'>" + org_text + "</p>";
  engCard.innerHTML = new_html;
  cardContainer.push(engCard);
}

for (i = 0; i < wordBankShuffle.length; i++) {
  var welCard = document.createElement('div');
  welCard.dataset.index = i;
  welCard.setAttribute('class', 'card');
  welCard.innerHTML = wordBankShuffle[i].welsh;
  welsh.push(wordBankShuffle[i].welsh);
  org_text = welCard.innerHTML;
  new_html = "<p class='hidden'>" + org_text + "</p>";
  welCard.innerHTML = new_html;
  cardContainer.push(welCard);
}

var i = cardContainer.length;
if (i == 0) return false;
while (--i) {
  var j = Math.floor(Math.random() * (i + 1));
  var tempi = cardContainer[i];
  var tempj = cardContainer[j];
  cardContainer[i] = tempj;
  cardContainer[j] = tempi;
}

/*insert new cards into DOM*/
let setOne = cardContainer.slice(0, 3);
let setTwo = cardContainer.slice(3, 6);
let setThree = cardContainer.slice(6, 9);
let setFour = cardContainer.slice(9, 12);

for (let i of setOne) {
  let element = document.getElementById("game-row");
  element.appendChild(i);
}

for (let i of setTwo) {
  let element = document.getElementById("game-row2");
  element.appendChild(i);
}

for (let i of setThree) {
  let element = document.getElementById("game-row3");
  element.appendChild(i);
}

for (let i of setFour) {
  let element = document.getElementById("game-row4");
  element.appendChild(i);
}

clickCards();
}

/* Add event listeners to cards for click */
function clickCards() {
let cards = document.querySelectorAll('.card');
for (i = 0; i < cards.length; i++) {
  cards[i].addEventListener('click', cardClicked);
}
}

/* Remove event listeners to cards to prevent more than 2 incorrect cards to be open at once*/

function stopClickCards() {
let cards = document.querySelectorAll('.card');
for (i = 0; i < cards.length; i++) {
  cards[i].removeEventListener('click', cardClicked);
}
}

/* Put words into translation table*/
function translate() {
let tableEntryEng = document.getElementsByClassName('english');
let tableEntryWel = document.getElementsByClassName('welsh');

for (i = 0; i < tableEntryEng.length; i++) {
  tableEntryEng[i].innerHTML = english[i];
}

for (i = 0; i < tableEntryWel.length; i++) {
  tableEntryWel[i].innerHTML = welsh[i];
}

}

/* Timer (code tutorial from https://dev.to/gspteck/create-a-stopwatch-in-javascript-2mak)*/ 
const timer = document.getElementById('timer');

var hr = 0;
var min = 0;
var sec = 0;
var stoptime = true;

/*start timer*/
function startTimer() {
  if (stoptime == true) {
        stoptime = false;
        timerCycle();
    }
}

/*stop timer*/
function stopTimer() {
  if (stoptime == false) {
    stoptime = true;
  }
}

function timerCycle() {
    if (stoptime == false) {
    sec = parseInt(sec);
    min = parseInt(min);
    hr = parseInt(hr);

    sec = sec + 1;

    if (sec == 60) {
      min = min + 1;
      sec = 0;
    }
    if (min == 60) {
      hr = hr + 1;
      min = 0;
      sec = 0;
    }

    if (sec < 10 || sec == 0) {
      sec = '0' + sec;
    }
    if (min < 10 || min == 0) {
      min = '0' + min;
    }
    if (hr < 10 || hr == 0) {
      hr = '0' + hr;
    }

    timer.innerHTML = hr + ':' + min + ':' + sec;

    setTimeout("timerCycle()", 1000);
  }
}
/* Reset timer*/
function resetTimer() {
    timer.innerHTML = "00:00:00";
    stoptime = true;
    hr = 0;
    sec = 0;
    min = 0;
}

/*Reset game on Play*/
function resetGame() {

document.getElementById('congrats').classList.add('hidden');

var x = document.getElementById("btn-play");
x.style.display = "none";
resetTimer();
english = [];
welsh = [];

}

/* Remove old cards from previous game */
function ditchOldCards() {

let cards = document.getElementsByClassName('card');
let cardArray = Array.from(cards);

for (var i = 0; i < cardArray.length; i++) {
  cardArray[i].classList.remove('done');
  cardArray[i].firstChild.classList.add('hidden');
  cardArray[i].remove();
}
}

/* Show congratulation message at game end */
function endGame() {

let allDone = document.getElementsByClassName('done');

if (allDone.length === 12) {
  document.getElementById('congrats').classList.remove('hidden');
  ditchOldCards();
  translate();
  stopTimer();
}

}
